#!/usr/bin/env python
# -*- coding:utf-8 -*-

import urllib, urllib2, sys,json
import ssl
import requests
import base64
import cv2
from PIL import Image

colordic = {'HotPink3': (205, 96, 144), 'AliceBlue': (240, 248, 255), 'Brown3': (205, 51, 51), 'LightCyan1': (224, 255, 255), 'LightCyan3': (180, 205, 205), 'NavajoWhite': (255, 222, 173), 'LightCyan4': (122, 139, 139), 'Brown': (165, 42, 42), 'DarkTurquoise': (0, 206, 209), 'CadetBlue4': (83, 134, 139), 'CadetBlue3': (122, 197, 205), 'CadetBlue2': (142, 229, 238), 'CadetBlue1': (152, 245, 255), 'VioletRed1': (255, 62, 150), 'VioletRed2': (238, 58, 140), 'VioletRed3': (205, 50, 120), 'VioletRed4': (139, 34, 82), 'Khaki4': (139, 134, 78), 'Khaki1': (255, 246, 143), 'Khaki2': (238, 230, 133), 'Khaki3': (205, 198, 115), 'Plum': (221, 160, 221), 'DarkGoldenrod': (184, 134, 11), 'SlateGrey': (112, 128, 144), 'NavajoWhite2': (238, 207, 161), 'DarkRed': (139, 0, 0), 'Plum4': (139, 102, 139), 'Plum3': (205, 150, 205), 'Plum2': (238, 174, 238), 'Plum1': (255, 187, 255), 'Goldenrod4': (139, 105, 20), 'Goldenrod1': (255, 193, 37), 'Goldenrod2': (238, 180, 34), 'Goldenrod3': (205, 155, 29), 'MistyRose': (255, 228, 225), 'DarkKhaki': (189, 183, 107), 'Bisque1': (255, 228, 196), 'Bisque2': (238, 213, 183), 'PowderBlue': (176, 224, 230), 'Tan': (210, 180, 140), 'PaleGreen1': (154, 255, 154), 'Green4': (0, 139, 0), 'PaleGreen3': (124, 205, 124), 'PaleGreen2': (144, 238, 144), 'Green1': (0, 255, 0), 'PaleGreen4': (84, 139, 84), 'Green3': (0, 205, 0), 'Green2': (0, 238, 0), 'RoyalBlue': (65, 105, 225), 'lavender': (230, 230, 250), 'LightBlue2': (178, 223, 238), 'Orange': (255, 165, 0), 'RosyBrown': (188, 143, 143), 'LightSkyBlue4': (96, 123, 139), 'LightCyan2': (209, 238, 238), 'LightSeaGreen': (32, 178, 170), 'BlueViolet': (138, 43, 226), 'Green': (0, 255, 0), 'Azure': (240, 255, 255), 'SkyBlue': (135, 206, 235), 'GhostWhite': (248, 248, 255), 'LavenderBlush': (255, 240, 245), 'SeaGreen': (46, 139, 87), 'BlanchedAlmond': (255, 235, 205), 'DarkOliveGreen': (85, 107, 47), 'Seashell2': (238, 229, 222), 'Seashell3': (205, 197, 191), 'Seashell1': (255, 245, 238), 'Seashell4': (139, 134, 130), 'Aquamarine4': (69, 139, 116), 'Yellow4': (139, 139, 0), 'Aquamarine1': (127, 255, 212), 'Yellow2': (238, 238, 0), 'Yellow1': (255, 255, 0), 'Aquamarine2': (118, 238, 198), 'Orchid4': (139, 71, 137), 'Orchid1': (255, 131, 250), 'Orchid2': (238, 122, 233), 'Orchid3': (205, 105, 201), 'LightSteelBlue': (176, 196, 222), 'DarkViolet': (148, 0, 211), 'DarkMagenta': (139, 0, 139), 'Cyan2': (0, 238, 238), 'Cyan3': (0, 205, 205), 'Cyan1': (0, 255, 255), 'Cyan4': (0, 139, 139), 'ForestGreen': (34, 139, 34), 'Maroon1': (255, 52, 179), 'Brown2': (238, 59, 59), 'HotPink2': (238, 106, 167), 'HotPink1': (255, 110, 180), 'Brown1': (255, 64, 64), 'Brown4': (139, 35, 35), 'HotPink4': (139, 58, 98), 'DodgerBlue3': (24, 116, 205), 'LightGoldenrod': (238, 221, 130), 'MedSpringGreen': (0, 250, 154), 'Tan4': (139, 90, 43), 'Tan3': (205, 133, 63), 'Tan2': (238, 154, 73), 'Tan1': (255, 165, 79), 'LightSlateBlue': (132, 112, 255), 'SteelBlue1': (99, 184, 255), 'SteelBlue3': (79, 148, 205), 'SteelBlue2': (92, 172, 238), 'SteelBlue4': (54, 100, 139), 'Sienna4': (139, 71, 38), 'Sienna1': (255, 130, 71), 'Sienna3': (205, 104, 57), 'Sienna2': (238, 121, 66), 'LightPink': (255, 182, 193), 'SlateGray4': (108, 123, 139), 'Blue': (0, 0, 255), 'Purple': (160, 32, 240), 'Wheat4': (139, 126, 102), 'Wheat1': (255, 231, 186), 'Wheat3': (205, 186, 150), 'Wheat2': (238, 216, 174), 'White': (255, 255, 255), 'Bisque': (255, 228, 196), 'gray1': (232, 232, 232), 'PapayaWhip': (255, 239, 213), 'OliveDrab4': (105, 139, 34), 'OliveDrab1': (192, 255, 62), 'OliveDrab2': (179, 238, 58), 'OliveDrab3': (154, 205, 50), 'SkyBlue4': (74, 112, 139), 'SkyBlue1': (135, 206, 255), 'SkyBlue3': (108, 166, 205), 'SkyBlue2': (126, 192, 238), 'goldenrod': (218, 165, 32), 'CornflowerBlue': (100, 149, 237), 'HotPink': (255, 105, 180), 'LimeGreen': (50, 205, 50), 'Yellow': (255, 255, 0), 'DarkBlue': (0, 0, 139), 'Gold3': (205, 173, 0), 'Gold2': (238, 201, 0), 'Chartreuse': (127, 255, 0), 'Peru': (205, 133, 63), 'Gold4': (139, 117, 0), 'Wheat': (245, 222, 179), 'Cyan': (0, 255, 255), 'MediumPurple': (147, 112, 219), 'MidnightBlue': (25, 25, 112), 'Coral': (255, 127, 80), 'Ivory': (255, 255, 240), 'Grey': (190, 190, 190), 'Beige': (245, 245, 220), 'DarkOrchid4': (104, 34, 139), 'Honeydew1': (240, 255, 240), 'Honeydew2': (224, 238, 224), 'Honeydew3': (193, 205, 193), 'Honeydew4': (131, 139, 131), 'DarkOrchid1': (191, 62, 255), 'DarkOrchid2': (178, 58, 238), 'DarkOrchid3': (154, 50, 205), 'FloralWhite': (255, 250, 240), 'Red4': (139, 0, 0), 'DarkSeaGreen': (143, 188, 143), 'Orchid': (218, 112, 214), 'Burlywood': (222, 184, 135), 'DarkSlateGray1': (151, 255, 255), 'DarkSlateGray2': (141, 238, 238), 'DarkSlateGray3': (121, 205, 205), 'DarkSlateGray4': (82, 139, 139), 'SteelBlue': (70, 130, 180), 'MediumSlateBlue': (123, 104, 238), 'Black': (0, 0, 0), 'Coral3': (205, 91, 69), 'Coral2': (238, 106, 80), 'Coral1': (255, 114, 86), 'Coral4': (139, 62, 47), 'Red3': (205, 0, 0), 'Red2': (238, 0, 0), 'Red1': (255, 0, 0), 'MediumVioletRed': (199, 21, 133), 'LtGoldenrodYello': (250, 250, 210), 'Pink1': (255, 181, 197), 'Pink3': (205, 145, 158), 'Pink2': (238, 169, 184), 'Pink4': (139, 99, 108), 'Cornsilk4': (139, 136, 120), 'Cornsilk2': (238, 232, 205), 'Cornsilk3': (205, 200, 177), 'Cornsilk1': (255, 248, 220), 'DodgerBlue': (30, 144, 255), 'RoyalBlue4': (39, 64, 139), 'RoyalBlue1': (72, 118, 255), 'RoyalBlue3': (58, 95, 205), 'RoyalBlue2': (67, 110, 238), 'MistyRose1': (255, 228, 225), 'MistyRose3': (205, 183, 181), 'MistyRose2': (238, 213, 210), 'MistyRose4': (139, 125, 123), 'LightGray': (211, 211, 211), 'LightYellow': (255, 255, 224), 'DarkOrange': (255, 140, 0), 'Snow4': (139, 137, 137), 'Snow2': (238, 233, 233), 'Snow3': (205, 201, 201), 'Snow1': (255, 250, 250), 'Burlywood1': (255, 211, 155), 'Burlywood3': (205, 170, 125), 'Burlywood2': (238, 197, 145), 'Burlywood4': (139, 115, 85), 'LightCoral': (240, 128, 128), 'DarkSlateGray': (47, 79, 79), 'Red': (255, 0, 0), 'IndianRed4': (139, 58, 58), 'LightSalmon': (255, 160, 122), 'IndianRed2': (238, 99, 99), 'IndianRed3': (205, 85, 85), 'IndianRed1': (255, 106, 106), 'SpringGreen2': (0, 238, 118), 'SpringGreen3': (0, 205, 102), 'SpringGreen4': (0, 139, 69), 'Moccasin': (255, 228, 181), 'LightPink2': (238, 162, 173), 'LightPink3': (205, 140, 149), 'LightPink1': (255, 174, 185), 'LightPink4': (139, 95, 101), 'MediumPurple1': (171, 130, 255), 'MediumPurple2': (159, 121, 238), 'MediumPurple3': (137, 104, 205), 'MediumPurple4': (93, 71, 139), 'Azure1': (240, 255, 255), 'Azure3': (193, 205, 205), 'Azure2': (224, 238, 238), 'Azure4': (131, 139, 139), 'Maroon': (176, 48, 96), 'Thistle3': (205, 181, 205), 'OrangeRed3': (205, 55, 0), 'OrangeRed2': (238, 64, 0), 'OrangeRed1': (255, 69, 0), 'OrangeRed4': (139, 37, 0), 'NavajoWhite4': (139, 121, 94), 'NavajoWhite1': (255, 222, 173), 'LawnGreen': (124, 252, 0), 'NavajoWhite3': (205, 179, 139), 'LightGoldenrod4': (139, 129, 76), 'LightGoldenrod1': (255, 236, 139), 'LightGoldenrod3': (205, 190, 112), 'LightGoldenrod2': (238, 220, 130), 'Cornsilk': (255, 248, 220), 'PaleGreen': (152, 251, 152), 'DarkGreen': (0, 100, 0), 'MediumOrchid': (186, 85, 211), 'DodgerBlue1': (30, 144, 255), 'DodgerBlue2': (28, 134, 238), 'PeachPuff': (255, 218, 185), 'DodgerBlue4': (16, 78, 139), 'DarkSeaGreen4': (105, 139, 105), 'DarkSeaGreen3': (155, 205, 155), 'DarkSeaGreen2': (180, 238, 180), 'DarkSeaGreen1': (193, 255, 193), 'MediumOrchid4': (122, 55, 139), 'MintCream': (245, 255, 250), 'MediumOrchid1': (224, 102, 255), 'MediumOrchid3': (180, 82, 205), 'MediumOrchid2': (209, 95, 238), 'Gold': (255, 215, 0), 'DeepSkyBlue': (0, 191, 255), 'Magenta': (255, 0, 255), 'DarkOrchid': (153, 50, 204), 'OliveDrab': (107, 142, 35), 'MediumTurquoise': (72, 209, 204), 'LightSalmon4': (139, 87, 66), 'LightSalmon2': (238, 149, 114), 'LightSalmon3': (205, 129, 98), 'LightSalmon1': (255, 160, 122), 'LightCyan': (224, 255, 255), 'Thistle2': (238, 210, 238), 'Thistle1': (255, 225, 255), 'Thistle4': (139, 123, 139), 'PaleGoldenrod': (238, 232, 170), 'AntiqueWhite3': (205, 192, 176), 'AntiqueWhite2': (238, 223, 204), 'AntiqueWhite1': (255, 239, 219), 'SlateBlue': (106, 90, 205), 'AntiqueWhite4': (139, 131, 120), 'DimGrey': (105, 105, 105), 'VioletRed': (208, 32, 144), 'WhiteSmoke': (245, 245, 245), 'NavyBlue': (0, 0, 128), 'Violet': (238, 130, 238), 'Ivory3': (205, 205, 193), 'Ivory2': (238, 238, 224), 'Ivory1': (255, 255, 240), 'Ivory4': (139, 139, 131), 'IndianRed': (205, 92, 92), 'Snow': (255, 250, 250), 'LightBlue': (173, 216, 230), 'PeachPuff4': (139, 119, 101), 'SaddleBrown': (139, 69, 19), 'PeachPuff1': (255, 218, 185), 'PeachPuff2': (238, 203, 173), 'PeachPuff3': (205, 175, 149), 'LemonChiffon3': (205, 201, 165), 'LemonChiffon2': (238, 233, 191), 'LemonChiffon1': (255, 250, 205), 'LemonChiffon4': (139, 137, 112), 'Tomato': (255, 99, 71), 'OldLace': (253, 245, 230), 'SlateGray3': (159, 182, 205), 'Tomato4': (139, 54, 38), 'Tomato1': (255, 99, 71), 'Tomato3': (205, 79, 57), 'Tomato2': (238, 92, 66), 'Orange4': (139, 90, 0), 'Orange1': (255, 165, 0), 'Orange3': (205, 133, 0), 'Orange2': (238, 154, 0), 'Sienna': (160, 82, 45), 'LightSkyBlue1': (176, 226, 255), 'LightSkyBlue2': (164, 211, 238), 'LightSkyBlue3': (141, 182, 205), 'LightYellow1': (255, 255, 224), 'LightYellow2': (238, 238, 209), 'LightYellow3': (205, 205, 180), 'LightYellow4': (139, 139, 122), 'Maroon4': (139, 28, 98), 'Maroon3': (205, 41, 144), 'Maroon2': (238, 48, 167), 'LemonChiffon': (255, 250, 205), 'YellowGreen': (154, 205, 50), 'Aquamarine': (127, 255, 212), 'Purple4': (85, 26, 139), 'Purple1': (155, 48, 255), 'Purple3': (125, 38, 205), 'Purple2': (145, 44, 238), 'DarkSalmon': (233, 150, 122), 'SlateGray1': (198, 226, 255), 'SlateGray2': (185, 211, 238), 'RosyBrown4': (139, 105, 105), 'RosyBrown3': (205, 155, 155), 'RosyBrown2': (238, 180, 180), 'RosyBrown1': (255, 193, 193), 'Salmon1': (255, 140, 105), 'Salmon3': (205, 112, 84), 'Salmon2': (238, 130, 98), 'Salmon4': (139, 76, 57), 'LightGreen': (144, 238, 144), 'LavenderBlush1': (255, 240, 245), 'Linen': (250, 240, 230), 'LavenderBlush3': (205, 193, 197), 'LavenderBlush2': (238, 224, 229), 'LavenderBlush4': (139, 131, 134), 'OrangeRed': (255, 69, 0), 'Chartreuse3': (102, 205, 0), 'Chartreuse2': (118, 238, 0), 'Chartreuse1': (127, 255, 0), 'MediumAquamarine': (102, 205, 170), 'Chartreuse4': (69, 139, 0), 'Pink': (255, 192, 203), 'Honeydew': (240, 255, 240), 'DarkGrey': (169, 169, 169), 'SlateBlue4': (71, 60, 139), 'SlateBlue3': (105, 89, 205), 'SlateBlue2': (122, 103, 238), 'SlateBlue1': (131, 111, 255), 'Chocolate': (210, 105, 30), 'DarkOliveGreen4': (110, 139, 61), 'DarkOliveGreen1': (202, 255, 112), 'DarkOliveGreen3': (162, 205, 90), 'DarkOliveGreen2': (188, 238, 104), 'Yellow3': (205, 205, 0), 'grey1': (181, 181, 181), 'Firebrick3': (205, 38, 38), 'Firebrick2': (238, 44, 44), 'Firebrick1': (255, 48, 48), 'Aquamarine3': (102, 205, 170), 'Firebrick4': (139, 26, 26), 'DarkGoldenrod4': (139, 101, 8), 'DarkGoldenrod1': (255, 185, 15), 'DarkGoldenrod2': (238, 173, 14), 'DarkGoldenrod3': (205, 149, 12), 'DeepPink': (255, 20, 147), 'Turquoise3': (0, 197, 205), 'Turquoise2': (0, 229, 238), 'Turquoise1': (0, 245, 255), 'Turquoise4': (0, 134, 139), 'DarkCyan': (0, 139, 139), 'GreenYellow': (173, 255, 47), 'Magenta4': (139, 0, 139), 'Magenta3': (205, 0, 205), 'Magenta2': (238, 0, 238), 'Magenta1': (255, 0, 255), 'DarkOrange4': (139, 69, 0), 'DarkOrange1': (255, 127, 0), 'DarkOrange3': (205, 102, 0), 'DarkOrange2': (238, 118, 0), 'SpringGreen1': (0, 255, 127), 'Bisque4': (139, 125, 107), 'Gainsboro': (220, 220, 220), 'PaleTurquoise': (175, 238, 238), 'Bisque3': (205, 183, 158), 'DeepPink3': (205, 16, 118), 'DeepPink2': (238, 18, 137), 'DeepPink1': (255, 20, 147), 'MediumSeaGreen': (60, 179, 113), 'DeepPink4': (139, 10, 80), 'DarkSlateBlue': (72, 61, 139), 'PaleVioletRed4': (139, 71, 93), 'PaleVioletRed1': (255, 130, 171), 'PaleVioletRed2': (238, 121, 159), 'PaleVioletRed3': (205, 104, 137), 'AntiqueWhite': (250, 235, 215), 'PaleTurquoise4': (102, 139, 139), 'PaleTurquoise3': (150, 205, 205), 'PaleTurquoise2': (174, 238, 238), 'PaleTurquoise1': (187, 255, 255), 'SpringGreen': (0, 255, 127), 'Salmon': (250, 128, 114), 'SandyBrown': (244, 164, 96), 'SeaGreen4': (46, 139, 87), 'SeaGreen3': (67, 205, 128), 'SeaGreen2': (78, 238, 148), 'SeaGreen1': (84, 255, 159), 'Turquoise': (64, 224, 208), 'Blue1': (0, 0, 255), 'Blue3': (0, 0, 205), 'Blue2': (0, 0, 238), 'Blue4': (0, 0, 139), 'DeepSkyBlue4': (0, 104, 139), 'DeepSkyBlue3': (0, 154, 205), 'DeepSkyBlue2': (0, 178, 238), 'DeepSkyBlue1': (0, 191, 255), 'CadetBlue': (95, 158, 160), 'Gold1': (255, 215, 0), 'Thistle': (216, 191, 216), 'LightSteelBlue1': (202, 225, 255), 'LightSteelBlue2': (188, 210, 238), 'LightSteelBlue3': (162, 181, 205), 'LightSteelBlue4': (110, 123, 139), 'LightBlue3': (154, 192, 205), 'Seashell': (255, 245, 238), 'LightSkyBlue': (135, 206, 250), 'LightBlue1': (191, 239, 255), 'LightBlue4': (104, 131, 139), 'MediumBlue': (0, 0, 205), 'LightSlateGray': (119, 136, 153), 'PaleVioletRed': (219, 112, 147), 'Chocolate1': (255, 127, 36), 'Chocolate2': (238, 118, 33), 'Chocolate3': (205, 102, 29), 'Chocolate4': (139, 69, 19), 'Firebrick': (178, 34, 34)}

# client_id 为官网获取的AK， client_secret 为官网获取的SK
host = 'https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&client_id=6T9XGnGwjIjWGfEnr0z7YgH1&client_secret=ajUbErA0rVs6kH9WqrihoRlPf87COxs1'
request = urllib2.Request(host)
request.add_header('Content-Type', 'application/json; charset=UTF-8')
response = urllib2.urlopen(request)
content = response.read()
if (content):
    content = json.loads(content)
    print(content["access_token"])

imgpath = "./redball.jpg"

f = open(imgpath, 'rb')
img = base64.b64encode(f.read())

# url = "https://aip.baidubce.com/rest/2.0/image-classify/v1/animal" + "?access_token=" + content["access_token"]    #动物识别
# url = "https://aip.baidubce.com/rest/2.0/image-classify/v1/plant" + "?access_token=" + content["access_token"]    #植物识别
# url = "https://aip.baidubce.com/rest/2.0/image-classify/v1/flower" + "?access_token=" + content["access_token"]    #花卉识别
# url = "https://aip.baidubce.com/rest/2.0/image-classify/v1/classify/ingredient" + "?access_token=" + content["access_token"]    #果蔬识别
# url = "https://aip.baidubce.com/rest/2.0/image-classify/v1/landmark" + "?access_token=" + content["access_token"]    #地标识别
# url = "https://aip.baidubce.com/rest/2.0/image-classify/v1/redwine" + "?access_token=" + content["access_token"]    #红酒识别

url = "https://aip.baidubce.com/rest/2.0/image-classify/v1/object_detect" + "?access_token=" + content["access_token"]   #识别主体物品

header={'Content-Type':'application/x-www-form-urlencoded'}
body = {"image":img }

r = requests.post(url=url,data=body,headers=header)

print r.text,type(r.text)

dic = r.text.encode("utf-8")
dic = json.loads(dic)
dic = dic["result"]
print dic,type(dic)

img = cv2.imread(imgpath)

y1, y2 = int(dic["top"]), int(dic["height"])
x1, x2 = int(dic["left"]), int(dic["width"])
y2 += y1
x2 += x1

cut = img[y1:y2, x1:x2]

cv2.imshow("img",cut)
cv2.waitKey()

p = Image.open(imgpath)
p = p.load()
top,height  = int(dic["top"]), int(dic["height"])
left, width = int(dic["left"]), int(dic["width"])
col = p[left+width/2,top+height/2]

print type(col),col
print type(colordic['AliceBlue']),colordic['AliceBlue']

d = 100000
cs = ""
for i in colordic:
    s = (colordic[i][0] - col[0]) * (colordic[i][0] - col[0]) + (colordic[i][1] - col[1]) * (colordic[i][1] - col[1]) + (colordic[i][2] - col[2]) * (colordic[i][2] - col[2])
    if s <= d:
        d = s
        cs = i

print cs